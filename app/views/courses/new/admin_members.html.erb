<% content_for :footer_scripts_and_styles do %>
  <script type="text/javascript">
    function showLoadingUsers(){
      document.getElementById('loading_bar').style.display = 'block';
      $('user_list_table').remove();
    }
</script>
<% end %>
<%= render :partial => 'courses/new/sidebar' %>
<div class="main grid_12 omega big-col">
  <%= render :partial => 'courses/new/breadcrumbs' %>
  <%= render :partial => 'courses/new/header',
    :locals => { :course => @course } %>
  <div id="course-manage" class="body">
    <div class="header">
      <h4>Gerenciamento</h4>
      <span class="counter">Listagem de membros do curso <%= @course.name %></span>
    </div>
    <%
      fake_tabs ["Informações", edit_environment_course_path(@environment, @course), {:class => 'icon'}],
        ["Membros", admin_members_environment_course_path(@environment, @course), {:class => 'icon'}],
        ["Moderação", admin_members_requests_environment_course_path(@environment, @course), {:class => 'icon'}],
        ["Disciplinas", admin_spaces_environment_course_path(@environment, @course), {:class => 'icon'}] do
      %>
    <% if @memberships && @memberships.size > 0 %>
      <% form_remote_tag :url => {:action => :search_users_admin,
        :id => @environment.id},
        :loading => "showLoadingUsers()",
        :html =>  { :class => "common filter"} do %>
        <div class="filters clearfix">
          <% field_set_tag "Buscar", :class => "grid_4 alpha inline hidden" do %>
            <%= label_tag :search_user, "Nome" %>
            <%= text_field_tag :search_user, nil, :class => "nano" %>
          <% end %>
          <% field_set_tag nil, :class => "grid_4 omega inline" do %>
            <ul class="columns">
              <li>
                <%= check_box_tag :role_filter, Role[:member].id %>
                <%= label_tag :role_filter, "Membro", :class => "inline" %>
              </li>
              <li>
                <%= check_box_tag :role_filter, Role[:tutor].id %>
                <%= label_tag :role_filter, "Tutor", :class => "inline" %>
              </li>
              <li>
                <%= check_box_tag :role_filter, Role[:teacher].id %>
                <%= label_tag :role_filter, "Professor", :class => "inline" %>
              </li>
              <li>
                <%= check_box_tag :role_filter, Role[:environment_admin].id %>
                <%= label_tag :role_filter, "Administrador", :class => "inline" %>
              </li>
            </ul>

          <% end %>
          <%= submit_tag 'Filtrar',
            :style => "float: right;" %>
        </div>
      <% end %>

      <div id="user_list">
        <%= render :partial => 'courses/new/user_list_admin',
          :locals => {:memberships => @memberships}%>
      </div>
    <% else %>
      <div class="box_notice">Não há usuários no curso.</div>
    <% end %>
    <%= will_paginate  @memberships, :renderer => EndlessRenderer %>
  <% end %>
</div>
</div>
