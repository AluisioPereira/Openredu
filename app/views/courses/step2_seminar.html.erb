<script type="text/javascript">
	function youtubePreview(textfield){
		regex = /youtube\.com\/watch\?v=([A-Za-z0-9._%-]*)[&\w;=\+_\-]*/;

		id = textfield.value.match(regex)
		if (id != null) {
			youtube_id = id[1];
			//alert(youtube_id)
			url = "http://www.youtube.com/v/" + youtube_id + "&hl=en&fs=1";
			
			jQuery('#yt_preview_param').attr("value",url);
			jQuery('embed').attr("src",url);
			jQuery('#youtube_preview').show();
			
		}  else {
			$('#youtube_preview').hide();
		}
			
	}
	
	function switchCourseFields(fieldType){
		if (fieldType == 1) {
			$('#upload_resource_field').show();
			$('#external_resource_field').hide();
			$('#youtube_preview').hide();
			
		} else {
			$('#upload_resource_field').hide();
			$('#external_resource_field').show();
		}
		
	}
	
	function removeField(link){
		jQuery(link).parent("fieldset:first").hide()
		jQuery(link).siblings("input[type=hidden]:first").val("1")
	}
	
	function add_fields(link, association, content) {
		var new_id = new Date().getTime();
		var regexp = new RegExp("new_" + association, "g")
		jQuery(link).before("<fieldset>" + content.replace(regexp, new_id) + "</fieldset>");
	}
	
</script>

<script type="text/javascript" charset="utf-8">
  $(document).ready(function() {
		
		$('#seminar_external_resource').change(function(obj){
		youtubePreview(obj.target);
	});
		
		
		
		/*
		
    $('#seminar_media').click(function(event){
      event.preventDefault();
    });
		
  $('#seminar_media').uploadify({
    'uploader'            : '/javascripts/uploadify/uploadify.swf',
    'script'              : '/courses/create',
    'multi'               : false,
    'cancelImg'           : '/images/cancel.png'
    });
		
	
		
		  $('#seminar_submit').click(function(event){
				if ( $("input:checked").val() == 'upload') {
						event.preventDefault();
		  			$('#seminar_media').uploadifyUpload();
				}
				
			});*/
				
	});
</script>


<div class="grid_16">
<div id="breadcrumbs">
		<% if @school %>
	<a href="<%=application_url%>">início</a> > <a href="#">redes</a> > <%= link_to @school.name, @school %> > nova vídeo-aula
	<% else %>
	<a href="<%=application_url%>">início</a> > <a href="#">ensinar</a> > nova vídeo-aula
	<%end %>
</div>
</div>

<%= render(:partial => "schools/school_info", :locals=>{:show => false}) if @school%>

<div id="title_video">Nova vídeo-aula</div>

<div class="grid_9 push_3">
<table class="booking_steps" cellpadding="0" cellspacing="0">
							<tbody><tr>
								<td><span class="book_step disabled"><span><em>1</em>Informações Gerais</span></span></td>
								<td class="spacer">&nbsp;</td>
								<td><span class="book_step current"><span><em>2</em>Editor de Aula</span></span></td>
								<td class="spacer">&nbsp;</td>
								<td><span class="book_step disabled"><span><em>3</em>Publicação</span></span></td>
							</tr>
						</tbody></table>
</div>


<% form_for :seminar, @seminar, :url => { :action => "create" }, :html => { :multipart => true } do |f| %>
<div class="grid_16">
<%= f.error_messages %>
<%# error_messages_for :course, :seminar %>
</div>	
<%= hidden_field_tag("step", "2", options = {})%>
<%= hidden_field_tag("school_id", @school.id) if @school %>

	
<div class="grid_6">

<% field_set_tag 'Vídeo' do %>

<%= f.radio_button :external_resource_type, :redu, {:onchange => "switchCourseFields(2);"} %>
  <%= f.label :external_resource_type_redu, "Redu", :class => "inline" %>
  <%= f.radio_button :external_resource_type, :youtube, {:onchange => "switchCourseFields(2);"} %>
  <%= f.label :external_resource_type_youtube, "Youtube", :class => "inline"  %>
  <%= f.radio_button :external_resource_type, :upload, {:onchange => "switchCourseFields(1);"} %>
  <%= f.label :external_resource_type_upload, "Upload", :class => "inline"  %><br/><br/>	

  <div id="upload_resource_field" style="display:none;">
  <%= f.label :media, "Upload de vídeo" %>
  <%= f.file_field :media  %>
  (tamanho máximo: 50MB)
 	</div>	
	
  <div id="external_resource_field" style="display:block;">
  <%= f.label :external_resource, "Link do Vídeo" %>
  <%= f.text_field :external_resource  %>
  </div>
	
<%end %>

</div>	



	<div id="youtube_preview" style="display: none;" class="grid_6">
	<% field_set_tag 'Preview' do %>
		<object width="260" height="177">
		<param name="movie" value="none" id="yt_preview_param"/>
		<param name="allowFullScreen" value="true"/>
		<param name="allowscriptaccess" value="always"/>
		<embed src="none" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="260" height="177"/>
		</object> 
		<%end%>
	</div>

	



<div class="grid_16">
<%# render :partial => 'attachment_form', :locals => {:f => f, :course => @seminar}%>


<%= link_to '< Anterior', new_course_path(:step => '1'), :class => "button" %> 
<%= f.submit 'Próximo >', :class => "button" %> 

<br><%= link_to 'Cancelar', cancel_courses_path, :confirm => "Tem certeza que deseja sair do editor de aulas?" %>
</div>

<% end %>




