<%= render :partial => 'courses/sidebar',
  :locals => { :course => @course }  %>

<div class="main grid_12 omega big-col">
  <%= render :partial => 'courses/breadcrumbs',
    :locals => { :course => @course } %>
  <%= render :partial => 'courses/header',
    :locals => { :course => @course } %>

  <div id="course-spaces" class="hierarchy-listing-wrapper">
    <div class="header">
      <h4>Disciplinas</h4>
      <span class="counter">
        <%= pluralize(@course.spaces.length, 'disciplina')%>
      </span>
    </div>

    <div class="actions">
      <% unless @course.users.include?(current_user) %>
        <% if (current_page? preview_environment_course_path(@course.environment,
          course)) || @sidebar_preview %>
          <% if @course.can_add_entry? %>
            <%= link_to 'Participar',
              join_environment_course_path(@course.environment, @course),
              :method => :post, :class => 'join important'%>
          <% else %>
            <span class="join waiting">Limite de vagas atingido</span>
          <% end %>
        <% end %>
      <% else %>
        <% if @course.waiting_approval?(current_user) %>
          <span class="join waiting">Aguardando moderação</span>
        <% else %>
          <%= link_to 'Abandonar curso',
            unjoin_environment_course_path(@course.environment, @course),
            :method => :post,
            :confirm => 'Você perderá o vínculo e o acesso a este curso e isso não poderá ser desfeito. Tem certeza?',
            :class => 'leave icon icon-x-gray_8_8' %>
        <% end %>
      <% end %>
    </div>

    <% if can?(:manage, @course) %>
    <div class="admin-actions clearfix">
      <%= link_to 'Criar nova disciplina', new_space_path(:course_id => @course.id), :class => "button" %>
    </div>
    <% end %>

    <ul id="spaces_list" class="hierarchy-listing">
      <%= render :partial => 'spaces/item', :collection => @spaces %>
    </ul>

    <%= will_paginate @spaces, :renderer => EndlessRenderer %>
  </div><!-- end #environment-courses -->

</div><!-- end .main -->
