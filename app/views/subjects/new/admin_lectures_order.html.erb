<% content_for :header_scripts_and_styles do %>
  <%= javascript_include_tag "https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.10/jquery-ui.min.js" %>
  <script type="text/javascript" charset="utf-8">
  // Altera a ordem dos recursos.
  $(document).ready(function(){
      $( ".sortable tbody" ).sortable({
        stop: function(event, ui) {
        var lectures_ordered = $(this).sortable('toArray');
        $('.assets').val(lectures_ordered);
        }
      });
      $(".sortable li:odd").addClass("odd");
  })
  </script>
<% end %>
<%= render :partial => "subjects/new/sidebar" %>
<div class="main grid_12 omega big-col">
  <ol id="breadcrumbs" class="clearfix">
    <li>
      <%= link_to 'Home', home_user_path(current_user),
        :class => 'replacement home icon icon-redu_r8_c227_s1' %>
    </li>
    <li>
      <%= link_to @subject.space.course.environment.name,
        environment_path(@subject.space.course.environment),
        :class => 'replacement icon icon-redu_r8_c217_s1' %>
    </li>
    <li>
      <%= link_to @subject.space.course.name,
        environment_course_path(@subject.space.course.environment, @subject.space.course),
        :class => 'replacement icon icon-redu_r8_c313_s1' %>
    </li>
    <li>
      <%= link_to @subject.space.name, space_path(@subject.space),
        :class => 'replacement icon icon-redu_r8_c307_s1' %>
    </li>
    <li>
      <%= link_to @subject.title, space_subject_path(@space, @subject),
        :class => 'icon icon-redu_r11_c211_s1'%>
    </li>
  </ol>
  <%= render :partial => 'subjects/new/header',
    :locals => { :subject => @subject, :space => @space } %>
  <div id="subject-edit" class="hierarchy-listing-wrapper">
    <div class="header">
      <h4>Gerenciamento</h4>
      <span class="counter">Informações gerais do módulo <%= @subject.title %></span>
    </div>

    <% fake_tabs ["Informações", edit_space_subject_path(@space, @subject)],
      ["Recursos", admin_lectures_order_space_subject_path(@space, @subject)],
      ["Membros", admin_members_space_subject_path(@space, @subject)] do %>

        <% if @subject.published? %>
          <div class="box_notice">Você não pode alterar a ordem das aulas, pois o módulo está publicado.</div>
        <% else %>
          <% unless @subject.lectures.empty? %>
            <div class="pretty-text"><strong>Arraste as aulas para alterar a ordem destas no módulo!</strong></div>
            <div class="actions">
              <% form_tag admin_lectures_order_space_subject_path do %>
                <%= hidden_field_tag 'lectures_ordered', nil, :class => "assets" %>
                <%= submit_tag 'Atualizar' %>
              <% end %>
            </div>
            <div class="lazy_list clearfix">
              <table class="common spaced default sortable subject-assets">
                <thead>
                  <tr>
                    <th width="8%">Ordem</th>
                    <th width="60%">Nome</th>
                    <th colspan="2">Gerenciamento</th>
                  </tr>
                </thead>
                <tbody id="resources_list">
                  <%= render :partial => "subjects/new/asset_item",
                    :collection => @subject.lectures, :as => :item ,
                    :locals => { :space => @space, :subject => @subject } %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="box_notice">Este módulo não possui recursos.</div>
          <% end %>

          <div class="actions">
            <% form_tag admin_lectures_order_space_subject_path do %>
              <%= hidden_field_tag 'lectures_ordered', nil, :class => "assets" %>
              <%= submit_tag 'Atualizar' %>
            <% end %>
          </div>
          <% content_for :header_scripts_and_styles do %>
            <%= javascript_include_tag :ckeditor %>
          <% end %>
        <% end %>

    <% end %>
  </div><!-- end #subjec-edit -->
</div><!-- end .main -->
