<%= apply_color_picker_to "#environment_color" %>
<script type="text/javascript" charset="utf-8">
//<![CDATA[
$(document).ready(function(){
  $("#environment_name").bind('keyup blur', function(e){
    var slug = $(this).slug()
    $("#environment_path").val(slug);
    $("#url_preview .environment").html(slug);
  })

  $("#environment_path, #environment_courses_attributes_0_path").bind('keyup blur', function(e){
    var slug = $(this).slug()
    $(this).val(slug);
  })

  $("#environment_path").bind('keyup blur', function(){
    var slug = $(this).slug()
    $("#url_preview .environment").html(slug);
  })

  $("#environment_courses_attributes_0_path").bind('keyup blur', function(){
    var slug = $(this).slug()
    $("#url_preview .course").html(slug);
  })

  $("#environment_courses_attributes_0_name").bind('keyup blur', function(e){
    var slug = $(this).slug()
    $("#environment_courses_attributes_0_path").val(slug);
    $("#url_preview .course").html(slug);
  })

  $("input[name='environment[color]']").hide()
  $("input[name='environment[color]']").change(function(){
    color = $(this).css("background-color")
    $("#create-header").css("background-color", color)
  })

  $("#environment_name").bind('keyup blur', function(){
    $("div.name h3 > a").html($(this).val())
  })

  $("#environment_courses_attributes_0_name").bind('keyup blur', function(){
    $("div.course h4 > a").html($(this).val())
  })

})
//]]>
</script>
<div class="clearfix" id="checkout">
  <%= render :partial => 'environments/wizard_breadcrumbs' %>

  <div class="grid_4 alpha">
    <h3>Etapa 2: <span>Informações</span></h3>
    <em class="description">Escreva as informações básicas do seu ambiente de estudo e do primeiro curso.</em>
  </div>
  <div id="url_preview">
    <span class="label">O seu endereço completo será:</span>
    <span class="base">redu.com.br/</span>
    <span class="environment"><%= @environment.path %></span>/
    <span class="base">cursos/</span>
    <span class="course"><%= @environment.courses.first.path %></span>
  </div>
  <div class="customizing">
    <% form_for @environment, :url => environments_path(:step => 3),
        :html => { :class => "highlightable form-common" } do |f| %>
        <%= f.error_messages %>
        <%= render :partial => 'environments/form', :locals => { :f => f } %>
        <%= hidden_field_tag :plan, @plan %>
        <%= f.submit "Assinar", :class => "important next"%>
      <% end %>
  </div>
</div>
