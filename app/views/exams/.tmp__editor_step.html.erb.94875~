
 <script>
     
     function remove_fields(link){
         $(link).prev("input[type=hidden]").val("1");
         $(link).closest(".fields").hide();
     }
     
     function add_fields(link, association, content, type){
         var new_id = new Date().getTime();
         
         var regexp = new RegExp("new_" + association, "g")
         
         if (jQuery('#question').length > 6) {
             return;
         }
         
         if (type == 'Alternative') {
             $(link).before(content.replace(regexp, new_id));
             $(link).parent().find('input[type=radio]').each(function(idx){
                 $(this).attr('value', idx)
             })
             
         }
         else 
             if (type == 'Question') {
                 $('div.add-topic-inner').hide();
                 // $(link).before(content.replace(regexp, new_id));
                 $('#questions > fieldset:last').after(content.replace(regexp, new_id));
                 
                 $('[value=new_alternatives]').each(function(idx){
                     $(this).attr('value', idx)
                 });
                 
                 makeIndexes();
                 
                 reloadMce();
             }
     }
     
     function makeIndexes(){
         $('.q_index').each(function(idx){
             $(this).html(idx + 1)
         });
         
         $('.alternatives').each(function(idx){
         
             $(this).find('input[type=radio]').each(function(idx2){
                 $(this).attr('value', idx2)
             });
         });
         
     }
     
     function removeAllMce(){
         var i, t = tinyMCE.editors;
         for (i in t) {
             if (t.hasOwnProperty(i)) {
                 t[i].remove();
             }
         }
         
     }
     
     function reloadMce(){
     <%= raw_tiny_mce_init %>
     }
     
     function makeIt(){
         $('.expanded').each(function(index){
             var name = $(this).attr('name')
             var content = tinyMCE.get(name + '_statement').getContent()
             
             $('#' + name + '_stat').html(content)
         });
     }
     
     function toggleMinimize(link, minimize){
     
         if (minimize) {
             makeIt();
         }
         
         var name = $(link).parent().attr('name')
         //alert(name);
         $(name).slideToggle();
         return false;
     }
     
     
     jQuery(document).ready(function(){
     
         // caso refresh na pagina:
         // reinicializar
         removeAllMce();
         reloadMce();
         makeIndexes();
         
         
         $('[value=new_alternatives]').each(function(idx){
             $(this).attr('value', idx)
         });
         
         //seleciona os elementos a com atributo name="modal"
         $('a[name=modal]').click(function(e){
             //cancela o comportamento padrão do link
             e.preventDefault();
             
             //armazena o atributo href do link
             var id = $(this).attr('href');
             
             $('#lights-dimmed').fadeIn(2000);
             $(id).show();
             
             
             jQuery.ajax({
                 data: '',
                 dataType: 'script',
                 beforeSend: function(request){
                     $('#loading_questions').show();
                 },
                 type: 'get',
                 url: '<%= questions_database_exams_path %>'
             });
         });
         
         //se o botãoo fechar for clicado
         $('.close').click(function(e){
             //cancela o comportamento padrão do link
             e.preventDefault();
             $('#lights-dimmed, .modal_window').hide();
         });
         
         //se div#lights-dimmed for clicado
         $('#lights-dimmed').click(function(){
             $(this).hide();
             $('.window').hide();
         });
     });
 </script>




	<div id="menu_bar" class="grid_16">
	
		<div class="add-topic-outter" style="float:left;">
          
					
					<a id="add_topic_link" href="#" onclick="$('div.add-topic-inner').toggle(); $(this).toggleClass('selected'); return false;">Questão</a>
          	<div class="add-topic-inner menudiv">
              <ul class="selectable">
                  <li>
											<%= link_to_add_fields((image_tag 'icons/iclass.gif', :title => "Nova questão") + 'Nova questão', f, :questions, 'Question') %>

                  </li>
                  <li>
                  	  <%= link_to (image_tag 'icons/iclass.gif', :title => 'Buscar Questão') + 'Buscar Questão', "#dialog", :name=>"modal" %>
                  </li>
              </ul>
          </div>
					
					|
					<%= link_to_function "Salvar", "save(false)", :id => "save_link"%>
          |
					<%= link_to_function "Pré-visualizar", "save(true)", :id => "preview_link"%>
				
     </div>	
			
		<div style="text-align:right; margin-right: 10px;">
      <%= image_tag 'spinner.gif', :id => 'save-spinner', :style => 'display: none' %>
      <span class="snippet" id="save_info"></span>
  	</div>
			

		</div>

 
  <%= hidden_field_tag("school_id", @school.id) if @school %>
 
  <%# hidden_field_tag("step", "2", options = {})%>
  <%# hidden_field_tag("exam_type", "simple", options = {})%>
  <%# hidden_field_tag('sbt_opt', 0) %>
  <%# hidden_field_tag('opt_param', 0) %>
  <%# f.hidden_field(:id, :value => @exam.id) %>
 
 <div class="grid_9">
 <div id="questions" style="min-height: 100px;">
 
  <% @exam.questions.each_with_index do |question, idx|%>
	
	  <% f.fields_for :questions, question do |builder| %>
	    <%= render "question_fields", :f => builder %>
	  <% end %>
	
	<% end %>
 

 	 <%= link_to_add_fields 'Nova Questão', f, :questions, 'button' %>
  <%= link_to 'Buscar Questão', "#dialog", :name=>"modal", :class => "button" %>
 
 </div>
 
 
</div>
<div class="grid_6 push_1">
    <div class="y_addinfo">
        <div class="addinfocontent">
            <h1>Adicione questões do banco de dados!</h1>
            <p>
                Varias questes estao disponiveis.
            </p>
            <p>
                <%= link_to 'Clique aqui!', "#dialog", :name=>"modal" %>
            </p>
        </div>
    </div>
</div>

  
  
 

 
 
 
 
 
 
 
 