<%= render :partial => 'shared/management_background' %>
<%= render :partial => 'environments/sidebar', :locals => { :environment => @environment } %>
<div class="main grid_12 omega big-col">
  <%= render :partial => 'environments/breadcrumbs',
    :locals => { :environment => @environment } %>

  <%= render :partial => 'environments/admin/header',
    :locals => { :environment => @environment } %>

  <div id="environment-manage" class="body management">
    <%= render :partial => "environments/admin/clean_header" %>

    <%= tabs :environments_admin do %>
      <h3 class="form-header">
        Papéis e permissões de <%= link_to @user.display_name, user_path(@user), :class => "strong" %>
      </h3>
      <%= render :partial => 'roles/change_role', :locals => { :membership => @environment_membership } %>
    <div class="role-user-info">
      <%= image_tag @user.avatar(:thumb_32), :class => "avatar", :size => "32x32" %>
      <%= link_to @user.email, @user, :class => "call" %>
      <span class="info">Inscreveu-se há <%= time_ago_in_words(@environment_membership.created_at) %></span>
    </div>
    <% unless @courses.empty? %>
      <table class="admin-role-table">
        <thead style="display: none;">
          <tr>
            <th>Curso</th>
            <th>Papel</th>
            <th>Editar</th>
          </tr>
        </thead>
        <tbody>
          <% @courses.each do |membership| %>
            <tr>
              <%= form_tag user_update_roles_path(@user, @environment),
                :method => :post do %>
                <td class="edit-roles">
                  <% unless @environment_membership.role.eql?(Role[:environment_admin]) %>
                    <%= label_tag "roles_#{Role[:teacher]}", "Professor", :class => "label " %>
                    <%= radio_button_tag :roles, Role[:teacher], membership.role.eql?(Role[:teacher]) ? true : false, :class => "input-checkbox"  %>
                    <%= label_tag "roles_#{Role[:member]}", "Membro", :class => "label" %>
                    <%= radio_button_tag :roles, Role[:member], membership.role.eql?(Role[:member]) ? true : false , :class => "input-checkbox" %>
                    <%= label_tag "roles_#{Role[:tutor]}", "Tutor", :class => "label" %>
                    <%= radio_button_tag :roles, Role[:tutor], membership.role.eql?(Role[:tutor]) ? true : false, :class => "input-checkbox"  %>
                    <%= hidden_field_tag :type, 'course' %>
                    <%= hidden_field_tag :course_id, membership.course.id %>
                  <% else %>
                    <div class="box_notice">Este usuário é administrador do ambiente. Seu papel não pode ser mudado.</div>
                  <% end %>
                </td>
                <td class="course-cell">
                  <%= link_to membership.course.name,
                    environment_course_path(@environment, membership.course), :class => "course-name" %>
                </td>
                <td class="edit-cell">
                  <%= submit_tag "Alterar", :class => "concave-button" %>
                </td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  <% end %>
  <%= link_to "Sair", environment_path(@environment), :class => "manage exit icon-manage-gray_8_10-before" %>
</div>
</div>

