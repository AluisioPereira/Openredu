<script>

//TODO validar numero de chaves > 0
function requestKeysToSchool(schoolId){
	var keysNumber = $('keys_number').val();//document.geteleme
	alert('você solicitou '+keysNumber +' chaves para a escola: '+schoolId);
}

function showRequestKeysBox(){
		document.getElementById('request_keys_link').style.display = 'none';
        document.getElementById('request_keys_box').style.display = 'inline';
}

function selectAll(){
	//$('select_all_link').hide();
	//$('select_all_string').show();
	var checkboxes = document.getElementsByName("ids[]");
	for (var i =0; i< checkboxes.length; i++) {
		checkboxes[i].checked = true;
	}
	
}

function selectNone(){
	var checkboxes = document.getElementsByName("ids[]");
	for (var i =0; i< checkboxes.length; i++) {
		checkboxes[i].checked = false;
	}
}

function selectNewExpirationDate(){
	return confirm("selecionou opcao 1 e data válida?");
}

function changeOption(optionSelect){
	//var optionSelect = document.getElementById('option');
	
	var option = optionSelect.selectedIndex;
	//alert(option);
	if (option == 0) { // Renovar prazo
	document.getElementById('role_id').style.display = 'none';
		
	} else if (option == 1) { // Renovar chave
	document.getElementById('role_id').style.display = 'none';
		//confirm('As chaves selecionadas serão substituídas por novas chaves com ')
	} else if (option == 2) { // Mudar papel
		document.getElementById('role_id').style.display = 'inline';
	}
	
}


</script>

<h1>Listando chaves de <%= @school.name %></h1>

<p>
	<% if current_user && (current_user.school_admin?(@school)) %>
		<a href="#" id="request_keys_link" onclick="javascript:showKeysSchoolBox();return false;">Solicitar senhas...</a>
	<% end %>
	
	<div id="request_keys_box" style="display:none;">
		    Número de chaves: 
			<input type="text" id="keys_number" maxlength="5" size="5"/>
			Data de expiração:
			<!-- calendar_date_select :start_time, :time => true, :popup => "force" -->
		    <button onclick="requestKeysToSchool(<%= @school.id %>);">
		        OK
		    </button>
	</div>
 
</p>



<% form_tag({:action => :manage_keys}, {:onSubmit => 'selectNewExpirationDate()', :method => "get"}) do %>



Selecionar: 
<a href="#" id="select_all_link" onclick="javascript:selectAll();return false;">Todas</a> | 
<a href="#" id="select_none_link" onclick="javascript:selectNone();return false;">Nenhuma</a>

| Ação:
<%= select_tag(:option, options_for_select([['Renovar prazo', 1], ['Renovar chave', 2], ['Mudar papel', 3]], 1), :onchange => "changeOption(this);") %>
<!-- TODO só aparecerá se selecao for 'mudar papel' 
	TODO os papeis são pegos do banco de dados -->

<%= select_tag(:role_id, options_from_collection_for_select(Role.find(:all, :conditions => ['school_role = ?', true]), :id, :name), :style => "display: none")%>
<%= submit_tag("OK") %> 
<!-- TODO tirar botao de submissao? -->

| Ordenar:
<%= select_tag(:reorder, options_for_select([['Nome de aluno', 1], ['Papel', 2], ['Data de expiração', 3]], 1)) %>


<BR>
<hr>

<div id="school_keys_list" style="min-height: 200px">
	
<% if @user_school_associations && @user_school_associations.length > 0 %>

<table>
  <tr>
  	<th></th>
    <th>Chave</th>
	<th>Usuário</th>
	<th>Papel</th>
    <th>Data de expiração</th>
  </tr>
<% @user_school_associations.each do |association| %>
  <tr>
  	<td><%= check_box_tag("ids[]",association.id) %></td>
  	<td><%=h association.access_key.key %></td>
    <td>
    	<%=h association.user ? association.user.login : 'livre' %>
	</td>
	<td>
    	<%=h association.role.name %>
	</td>
    <td><%=h association.access_key.expiration_date %></td>
  
     </tr>
<% end %>
</table>
<% else %>

Esta escola não possui chaves ainda. 

<% end %> 

<% end %> 
 
</div>

